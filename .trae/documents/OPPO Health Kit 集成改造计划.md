# 代码质量修复与规则更新计划

您提到代码分析发现了 111 个错误和 119 个警告，并要求更新项目规则以确保交付质量。以下是我的执行计划：

## 1. 更新项目规则
*   **目标**: 强制执行“先检查，后交付”的流程。
*   **操作**: 修改 `.trae/rules/project_rules.md`，添加以下规则：
    > "任务完成前必须先进行代码分析（`./gradlew lint`），修复发现的问题，然后进行编译构建（`./gradlew assembleDebug`），确保代码分析无问题、编译成功且运行正常后方可交付。"

## 2. 执行代码分析与诊断
*   **操作**: 运行 `./gradlew lint` 获取详细的错误和警告报告。
*   **分析**: 我将分析报告中的问题类型，预计主要包含：
    *   **Correctness (错误)**: 潜在的空指针、API 使用错误、资源引用错误。
    *   **Security (错误)**: 硬编码密钥、不安全的网络配置。
    *   **Performance (警告)**: 布局嵌套过深、未使用的资源。
    *   **Usability (警告)**: 缺少 `contentDescription`、硬编码文本。
    *   **Kotlin Interoperability (警告)**: 平台类型未指定非空性等。

## 3. 修复代码问题 (迭代进行)
鉴于错误数量较多，我将分批次修复：

*   **第一批：修复 Error 级别的致命问题**
    *   修复所有导致编译失败或运行时崩溃的逻辑错误。
    *   修复 Manifest 配置错误。
    *   处理硬编码的敏感信息（如果有）。

*   **第二批：修复高频 Warning**
    *   **UI 问题**: 为 Image/Icon 添加 `contentDescription`。
    *   **资源清理**: 删除未使用的变量、导入和资源文件。
    *   **API 适配**: 处理 Deprecated API 调用（如 `startActivityForResult` 等）。

*   **第三批：代码规范与优化**
    *   提取硬编码字符串到 `strings.xml`。
    *   优化 Compose 布局结构。

## 4. 验证与交付
*   **验证步骤**:
    1.  运行 `./gradlew lint` 确认错误数降为 0（或仅剩无法修复的误报，需加 `@Suppress`）。
    2.  运行 `./gradlew assembleDebug` 确保构建成功。
    3.  (可选) 建议您在本地运行应用以确保业务逻辑正常。

请确认是否开始执行此计划？