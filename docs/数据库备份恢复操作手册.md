# 数据库备份恢复操作手册

## 1. 简介
本手册指导用户及运维人员如何进行 BeHealthy App 的数据库备份与恢复操作。

## 2. 自动备份机制
系统内置自动备份功能，无需人工干预。
*   **执行时间**: 每日凌晨 2:00 - 4:00 (设备空闲且充电时优先)。
*   **存储位置**: 应用私有目录 `database_backups/`。
*   **保留周期**: 自动保留最近 30 份备份，超期自动清理。

## 3. 手动备份操作
当用户更换设备或进行重要操作前，建议手动备份。
1.  进入 App **"我的" (Profile)** 页面。
2.  点击 **"数据备份与恢复"** 入口。
3.  点击 **"立即创建备份"** 按钮。
4.  等待提示 "备份成功"，列表顶部将显示最新备份记录。

## 4. 数据恢复操作
**警告**: 恢复操作将覆盖当前所有数据，且不可撤销！
1.  进入 App **"我的" (Profile)** 页面。
2.  点击 **"数据备份与恢复"** 入口。
3.  在 "历史备份列表" 中选择需要恢复的备份文件。
4.  点击右侧 **"恢复"** 图标。
5.  在弹出的确认对话框中，仔细阅读警告，点击 **"确定恢复"**。
6.  等待提示 "恢复成功"，App 数据即恢复至该备份点的状态。
7.  建议重启 App 以确保所有内存缓存刷新。

## 5. 异常处理
### 5.1 备份失败
*   **现象**: 提示 "备份失败" 或操作超时。
*   **排查**:
    *   检查设备存储空间是否充足。
    *   检查 App 是否有文件读写权限（通常无需额外权限，因使用私有目录）。
    *   查看日志 `BackupManager: Backup failed` 获取详细错误堆栈。

### 5.2 恢复失败
*   **现象**: 提示 "恢复失败" 或数据未变化。
*   **排查**:
    *   确认备份文件是否完整（列表显示文件大小，如为 0KB 则无效）。
    *   检查数据库文件是否被其他进程占用（尝试重启 App 后重试）。
    *   **紧急方案**: 如果 App 无法启动，可尝试清除应用数据（这将丢失所有未备份数据），然后重新安装。

## 6. 物理隔离与导出 (高级)
目前备份文件存储在手机内部存储。为防止手机丢失导致数据全损，建议定期将备份文件导出到外部设备。
*(注：当前版本需通过 Android Studio Device File Explorer 或 Root 权限访问导出，后续版本将支持 "导出到外部存储" 功能)*
路径: `/data/data/com.behealthy.app/files/database_backups/`
