# 综合运动趋势图表规范与配置文档

## 1. 概述
本文档详细描述了 BeHealthy 应用中"综合运动趋势图表"的数据源结构、可视化配置及交互规范。该图表旨在通过单一视图展示用户的多维度运动数据（步数、热量、时长），帮助用户直观了解运动趋势。

## 2. 数据源结构 (Merged Data Source)

图表使用统一的数据模型 `DailyStatItem`，该模型聚合了来自 `DailyActivity`（系统自动计步/运动记录）和 `FitnessTask`（用户手动完成的任务）的数据。

### 2.1 数据模型定义

```kotlin
data class DailyStatItem(
    val date: LocalDate,   // 日期
    val calories: Int,     // 总消耗热量 (Kcal)
    val minutes: Int,      // 总运动时长 (分钟)
    val steps: Int,        // 总步数
    val mood: String?,     // 心情描述 (可选)
    val moodScore: Int     // 心情评分 (1-5分)
)
```

### 2.2 数据聚合逻辑
- **步数 (Steps)**: 优先读取 `DailyActivity` 中的步数数据。如果用户手动记录的任务中包含步数且总和大于系统记录，则取较大值（或根据具体业务逻辑累加）。
- **热量 (Calories)**: 聚合当日所有完成任务的预计/实际消耗热量 + 系统记录的额外热量。
- **时长 (Minutes)**: 聚合当日所有完成任务的运动时长。

## 3. 图表可视化配置 (Chart Configuration)

### 3.1 核心指标与配色
图表采用三条曲线/折线分别表示三个核心指标，配色遵循 OPPO Design 风格：

| 指标 | 颜色名称 | Hex 值 | 说明 |
| :--- | :--- | :--- | :--- |
| **步数 (Steps)** | OppoGreen | `#4CAF50` (近似) | 代表活力与健康，作为主指标 |
| **热量 (Calories)** | BritishRed | `#B71C1C` (近似) | 代表能量消耗，警示与动力 |
| **时长 (Minutes)** | Orange | `#E6A23C` | 代表坚持与耐力 |

### 3.2 坐标轴与网格
- **X轴**: 时间轴，根据筛选范围（周/月/年）动态调整刻度密度。
    - 策略: 当数据点 > 10 个时，每隔 3 个点显示一个日期标签，避免重叠。
- **Y轴**: 动态多尺度（归一化处理）。
    - 由于步数（几千）、热量（几百）、时长（几Pk十）的数量级差异巨大，图表内部采用 **相对百分比绘制**。
    - `y = chartHeight * (1 - value / maxValue)`
    - `maxValue` 动态计算：取当前时间范围内该指标的最大值，若为0则使用默认基准值（步数6000，热量100，时长60）。

### 3.3 交互设计
- **点击交互**: 用户点击图表区域的任意位置，系统根据 X 坐标计算最近的数据点索引。
- **Tooltip (信息浮层)**:
    - 选中数据点后，显示虚线垂直游标。
    - 弹出圆角矩形浮层，展示该日期的具体数值：
        - 日期 (yyyy-MM-dd)
        - 步数 (带颜色)
        - 热量 (带颜色)
        - 时长 (带颜色)
- **取消选中**: 再次点击同一位置或点击图表外区域可取消选中。

## 4. 响应式适配
- **高度**: 固定高度 250dp，确保在不同屏幕上占比合理。
- **宽度**: `fillMaxWidth()`，自适应屏幕宽度。
- **点间距**: `width / (dataSize + 0.5f)`，根据屏幕宽度和数据量动态计算点间距，确保线条流畅分布。

## 5. 使用示例

```kotlin
// 在 Compose 界面中调用
UnifiedTrendChartCard(dailyStats = uiState.dailyStats)
```

---
**版本**: 1.0
**更新日期**: 2026-02-13
